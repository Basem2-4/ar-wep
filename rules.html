<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† | Alamariyah RP</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-black" oncontextmenu="return false;">

    <nav class="navbar">
        <div class="nav-oval-container">
            <ul class="nav-links">
                <li><a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                <li><a href="rules.html" class="active">Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ†</a></li>
                <li><a href="https://basem2-4.github.io/ar-store/" class="shop-link gold-pulse" target="_blank">Ø§Ù„Ù…ØªØ¬Ø±</a></li>
                <li><a href="https://discord.gg/2yzKrHf7" target="_blank">Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯</a></li>
            </ul>
        </div>
    </nav>

    <div class="rules-header">
        <h1 class="gold-pulse">Ù‚ÙˆØ§Ù†ÙŠÙ† Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ø¹Ù…Ø§Ø±ÙŠØ© Ø£Ø± Ø¨ÙŠ </h1>
        <p class="crystal-white">Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Ù„Ù„Ù‚ÙˆØ§Ù†ÙŠÙ†</p>
    </div>

    <div id="rulesGrid" class="rules-main-grid"></div>

    <div id="rulesOverlay" class="rules-overlay" onclick="closeRules()">
        <div class="rules-rect-box" onclick="event.stopPropagation()">
            <div class="rules-top-bar">
                <span class="back-link" onclick="closeRules()">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</span>
                <h2 id="rulesTitle" class="gold-pulse"></h2>
            </div>
            <hr class="gold-divider">
            <ul id="rulesList" class="rules-list crystal-white"></ul>
        </div>
    </div>

    <div class="admin-trigger-container">
        <button id="adminBtn" onclick="loginAdmin()" class="btn-admin-open">ğŸ› ï¸ Ø¯Ø®ÙˆÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
    </div>

    <section id="adminPanel" class="admin-panel" style="display:none;">
        <div class="admin-card">
            <div class="admin-header">
                <h2 class="gold-pulse">ğŸ“ Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ Ù‚Ø³Ù…</h2>
                <button class="btn-close-admin" onclick="hideAdminPanel()">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù„ÙˆØ­Ø© Ã—</button>
            </div>
            <div class="admin-form">
                <div class="input-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…:</label>
                    <input type="text" id="catTitle" placeholder="Ù…Ø«Ø§Ù„: Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ø³Ø·Ùˆ">
                </div>
                <div class="input-group">
                    <label>Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† (ÙƒÙ„ Ø³Ø·Ø± Ù‚Ø§Ù†ÙˆÙ† Ù…Ù†ÙØµÙ„):</label>
                    <textarea id="catRules" rows="8" placeholder="1. ÙŠÙ…Ù†Ø¹..\n2. ÙŠØ¬Ø¨.."></textarea>
                </div>
                <input type="hidden" id="editId">
                <button onclick="saveData()" class="btn-save">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            </div>
        </div>
    </section>

    <script>
        // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±Ø¨Ø· Ø¨Ù€ MongoDB Data API ---
        // Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ø³ØªØ¨Ø¯Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ø£Ø¯Ù†Ø§Ù‡ Ø¨Ø±Ø§Ø¨Ø· Ø§Ù„Ù€ Endpoint Ø§Ù„Ø°ÙŠ Ù†Ø³Ø®ØªÙ‡ Ù…Ù† ÙˆØ§Ø¬Ù‡Ø© Data API
        const MONGODB_API_URL = "https://data.mongodb-api.com/app/data-flwxvzyq/endpoint/data/v1"; 
        const MONGODB_API_KEY = "0e889823-b64c-4c59-97be-b07a8cded3bf"; // Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø°ÙŠ Ø£Ø±Ø³Ù„ØªÙ‡
        
        const DB_CONFIG = {
            dataSource: "Cluster0",
            database: "AlamariyahDB",
            collection: "rules"
        };

        let rulesData = {};
        let isAdmin = false;

        // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„ØªØ´ØºÙŠÙ„
        async function loadRules() {
            try {
                const response = await fetch(`${MONGODB_API_URL}/action/findOne`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'api-key': MONGODB_API_KEY },
                    body: JSON.stringify({ ...DB_CONFIG, filter: { "type": "server_rules" } })
                });
                const result = await response.json();
                if (result.document) {
                    rulesData = result.document.data;
                } else {
                    rulesData = { "default": { title: "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ", list: ["Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù‚ÙˆØ§Ù†ÙŠÙ† Ø¨Ø¹Ø¯."] } };
                }
                renderGrid();
            } catch (e) { console.error("Error loading data", e); }
        }

        function renderGrid() {
            const grid = document.getElementById('rulesGrid');
            grid.innerHTML = '';
            for (let id in rulesData) {
                grid.innerHTML += `
                    <div class="rule-box" onclick="openRules('${id}')">
                        <div class="r-icon">ğŸ“œ</div>
                        <div class="r-txt">
                            <h3>${rulesData[id].title}</h3>
                            ${isAdmin ? `<button onclick="event.stopPropagation(); editRules('${id}')">ØªØ¹Ø¯ÙŠÙ„</button>` : ''}
                        </div>
                    </div>`;
            }
        }

        async function saveData() {
            const title = document.getElementById('catTitle').value;
            const text = document.getElementById('catRules').value;
            if (!title || !text) return alert("Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

            const id = title.replace(/\s+/g, '-').toLowerCase();
            rulesData[id] = { title: title, list: text.split('\n') };

            await fetch(`${MONGODB_API_URL}/action/updateOne`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'api-key': MONGODB_API_KEY },
                body: JSON.stringify({
                    ...DB_CONFIG,
                    filter: { "type": "server_rules" },
                    update: { "$set": { "data": rulesData } },
                    upsert: true
                })
            });
            alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!");
            location.reload();
        }

        function openRules(id) {
            document.getElementById('rulesTitle').innerText = rulesData[id].title;
            document.getElementById('rulesList').innerHTML = rulesData[id].list.map(l => `<li>${l}</li>`).join('');
            document.getElementById('rulesOverlay').style.display = 'flex';
        }

        function closeRules() { document.getElementById('rulesOverlay').style.display = 'none'; }
        
        function loginAdmin() {
            if (prompt("Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„:") === "admin123") {
                isAdmin = true;
                document.getElementById('adminPanel').style.display = 'block';
                renderGrid();
            }
        }

        function hideAdminPanel() { document.getElementById('adminPanel').style.display = 'none'; }

        loadRules();
    </script>
</body>
</html>
