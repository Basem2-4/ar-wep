<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù‚ÙˆØ§Ù†ÙŠÙ† Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ø¹Ù…Ø§Ø±ÙŠØ© | Supabase</title>
    <style>
        body { background: #000; color: white; font-family: 'Segoe UI', sans-serif; text-align: center; margin: 0; padding: 20px; }
        .gold-pulse { color: #d4af37; text-shadow: 0 0 10px #d4af37; margin-bottom: 30px; }
        .rules-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; padding: 10px; }
        .rule-card { border: 1px solid #d4af37; padding: 20px; border-radius: 12px; background: #111; transition: 0.3s; cursor: pointer; text-align: right; }
        .rule-card:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3); }
        .admin-section { background: #111; border: 1px dashed #d4af37; padding: 25px; border-radius: 15px; margin-top: 50px; max-width: 600px; margin-left: auto; margin-right: auto; }
        input, textarea { width: 100%; padding: 12px; margin: 10px 0; background: #222; border: 1px solid #444; color: white; border-radius: 8px; box-sizing: border-box; }
        button { background: #d4af37; color: black; padding: 12px 25px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; font-size: 16px; }
        button:hover { background: #fff; }
    </style>
</head>
<body>

    <h1 class="gold-pulse">âš–ï¸ Ù‚ÙˆØ§Ù†ÙŠÙ† Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ø¹Ù…Ø§Ø±ÙŠØ© (Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ)</h1>
    
    <div id="rulesGrid" class="rules-grid">
        <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† Ù…Ù† Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©...</p>
    </div>

    <div class="admin-section">
        <h3 class="gold-pulse">ğŸ› ï¸ Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ù‚ÙˆØ§Ù†ÙŠÙ† Ø¬Ø¯ÙŠØ¯</h3>
        <input type="text" id="catTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù‚Ø³Ù… (Ù…Ø«Ù„: Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ø³Ø·Ùˆ)">
        <textarea id="catRules" rows="6" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† Ù‡Ù†Ø§.. (ÙƒÙ„ Ù‚Ø§Ù†ÙˆÙ† ÙÙŠ Ø³Ø·Ø± Ù…Ù†ÙØµÙ„)"></textarea>
        <button onclick="saveToSupabase()">ğŸ’¾ Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    </div>

    <script>
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø¨Ø· Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ Ø§Ù„ØªÙŠ Ø²ÙˆØ¯ØªÙ†ÙŠ Ø¨Ù‡Ø§
        const SUPABASE_URL = "https://gksbobjzbuikeyudgmcf.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imdrc2JvYmp6YnVpa2V5dWRnbWNmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc2MjkzNzEsImV4cCI6MjA4MzIwNTM3MX0.WL054lY5hL6LGGM7P07TmnKWTwAEnh5v_yL6ROAYTMU";

        // 1. Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Supabase ÙˆØ¹Ø±Ø¶Ù‡Ø§
        async function loadRules() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/rules?select=*`, {
                    headers: {
                        "apikey": SUPABASE_KEY,
                        "Authorization": `Bearer ${SUPABASE_KEY}`
                    }
                });
                const data = await response.json();
                const grid = document.getElementById('rulesGrid');
                
                if (data.length === 0) {
                    grid.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚ÙˆØ§Ù†ÙŠÙ† Ù…Ø¶Ø§ÙØ© Ø­Ø§Ù„ÙŠØ§Ù‹.</p>";
                    return;
                }

                grid.innerHTML = data.map(item => `
                    <div class="rule-card">
                        <h3 style="color: #d4af37; margin-top: 0;">ğŸ“œ ${item.title}</h3>
                        <div style="line-height: 1.6; font-size: 14px; white-space: pre-wrap;">${item.content}</div>
                    </div>
                `).join('');
            } catch (error) {
                console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„:", error);
                document.getElementById('rulesGrid').innerHTML = "<p style='color:red;'>ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</p>";
            }
        }

        // 2. Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø§Ù„Ø­ÙØ¸)
        async function saveToSupabase() {
            const title = document.getElementById('catTitle').value;
            const content = document.getElementById('catRules').value;

            if (!title || !content) {
                return alert("ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰ Ø£ÙˆÙ„Ø§Ù‹.");
            }

            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/rules`, {
                    method: 'POST',
                    headers: {
                        "apikey": SUPABASE_KEY,
                        "Authorization": `Bearer ${SUPABASE_KEY}`,
                        "Content-Type": "application/json",
                        "Prefer": "return=minimal"
                    },
                    body: JSON.stringify({
                        title: title,
                        content: content
                    })
                });

                if (response.ok) {
                    alert("âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©!");
                    document.getElementById('catTitle').value = "";
                    document.getElementById('catRules').value = "";
                    loadRules(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙˆØ±Ø§Ù‹
                } else {
                    const errorMsg = await response.json();
                    console.error("Ø®Ø·Ø£ Supabase:", errorMsg);
                    alert("âŒ ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸: ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (RLS) ÙÙŠ Supabase.");
                }
            } catch (error) {
                alert("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.");
            }
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¬Ù„Ø¨ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        loadRules();
    </script>
</body>
</html>
